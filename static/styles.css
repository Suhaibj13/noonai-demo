:root{
  --bg:#0f1115; --panel:#151820; --muted:#a5adcb; --text:#e6e9f2;
  --accent:#2459ff; --accent-2:#7ee787; --danger:#ff6b6b; --border:#262a36;
  --composer-offset:160px;
}
@media (prefers-color-scheme: light){
  :root{ --bg:#f7f8fb; --panel:#fff; --muted:#5b6175; --text:#1b1e27; --accent:#2459ff; --accent-2:#1f9d55; --danger:#d64545; --border:#e6e8ef; }
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Arial,sans-serif;
  background:url('/static/noon.jpg') center/cover no-repeat fixed;
  color:var(--text);
}
.page{min-height:100dvh}

/* Glass */
.glass{
  position:fixed; inset:40px 80px;
  display:grid; grid-template-columns:280px 1fr; grid-template-rows:auto 1fr;
  border-radius:16px; border:1px solid rgba(255,255,255,.16);
  background:rgba(20,24,32,.35);
  backdrop-filter:blur(14px) saturate(140%); -webkit-backdrop-filter:blur(14px) saturate(140%);
  box-shadow:0 20px 40px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.06), inset 12px 0 24px rgba(0,0,0,.18), inset -12px 0 24px rgba(0,0,0,.18);
  overflow:hidden; z-index:10;
}
@media (prefers-color-scheme: light){
  .glass{
    background:rgba(255,255,255,.45); border:1px solid rgba(0,0,0,.08);
    box-shadow:0 20px 40px rgba(0,0,0,.15), inset 0 1px 0 rgba(255,255,255,.6), inset 12px 0 24px rgba(0,0,0,.06), inset -12px 0 24px rgba(0,0,0,.06);
  }
}

/* Header */
/* Header (smaller height) */
.topbar {
  grid-column: 1 / 3;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 16px;           /* reduced vertical padding */
  height: 56px;                /* explicit height, tighter than before */
  border-bottom: 1px solid var(--border);
  background: transparent;
}

.brand { display: flex; align-items: center; gap: 10px; }
.title h1 { font-size: 15px; margin: 0;}
.title p  { margin: 0; font-size: 11px; color: var(--muted); }
.status{font-size:12px; color:var(--muted)}
.status .badge{border:1px solid var(--border); padding:3px 8px; border-radius:999px; margin-right:6px; font-size:11px}
.status .sep{margin:0 6px}

/* ====== Noon Logo (circle bigger, smooth flip + join) ====== */
/* --- Noon logo: flip → shrink+slide left (n) + slide-in (oon) → both fall,
      while a full-size 'N' drops from above. No HTML changes required. --- */
/* --- Noon logo (round) — flip → tiny pause → slide+shrink with oon → tiny pause → fall --- */
/* --- Noon logo (round) — keep timing, but prevent 'oon' from covering 'n' --- */
/* --- Noon logo (smaller for compact topbar, synced fall) --- */
.noon-logo {
  position: relative;
  width: 44px; height: 44px;       /* smaller circle */
  border-radius: 50%;
  background: #ffd600;
  display: grid; place-items: center;
  overflow: hidden;
  isolation: isolate;
  perspective: 600px;
  box-shadow: 0 0 0 1px #00000014 inset, 0 2px 5px rgba(0,0,0,.15);
  --n-shift: -16px;     /* move 'n' a bit further left when parked */
  --oon-shift: 6px;    /* mirror the 'oon' shift to the right */
  --n-scale: .75;       /* keep or tweak to .75 if you need more room */
}

/* elements */
.logo-n,
.logo-oon {
  position: absolute; inset: 0;
  display: grid; place-items: center;
  font-weight: 800; color: #0b0d12;
  user-select: none; backface-visibility: hidden;
  will-change: transform, opacity;
}
.logo-n  { z-index: 3; font-size: 18px; animation: nFlipHoldSlideFall 5s ease-in-out infinite both; }
.logo-oon{ z-index: 2; font-size: 14px; animation: oonHoldSlideFall   5s ease-in-out infinite both; }

/* big N (no HTML changes) */
.noon-logo::after {
  content:"n";
  position:absolute; inset:0; display:grid; place-items:center;
  font-weight:800; color:#0b0d12; font-size:18px;
  transform: translateY(-130%); opacity:0;
  z-index:1;
  animation: nBigDrop 5s ease-in-out infinite both;
}

/* ===== Keyframes ===== */
/* n: flip → pause → shrink+slide left → pause → fall */
@keyframes nFlipHoldSlideFall {
  0%   { transform: rotateY(0) scale(1) translateX(0) translateY(0); opacity:1; }
  18%  { transform: rotateY(360deg) scale(1) translateX(0) translateY(0); opacity:1; }
  24%  { transform: rotateY(360deg) scale(1) translateX(0) translateY(0); opacity:1; }
  48%  { transform: rotateY(360deg) scale(var(--n-scale)) translateX(var(--n-shift)) translateY(0); opacity:1; }
  58%  { transform: rotateY(360deg) scale(var(--n-scale)) translateX(var(--n-shift)) translateY(0); opacity:1; }
  100% { transform: rotateY(360deg) scale(var(--n-scale)) translateX(var(--n-shift)) translateY(120%); opacity:0; }
}

@keyframes oonHoldSlideFall {
  0%,23% { transform: translateX(110%); opacity:0; }
  24%    { transform: translateX(110%); opacity:.15; }
  48%    { transform: translateX(var(--oon-shift)); opacity:1; }
  58%    { transform: translateX(var(--oon-shift)); opacity:1; }
  100%   { transform: translateY(120%); opacity:0; }
}

/* big N: delayed drop to coincide with fall of n+oon */
@keyframes nBigDrop {
  0%,57% { transform: translateY(-130%); opacity:0; }
  64%    { transform: translateY(-130%); opacity:1; }
  84%    { transform: translateY(0%);    opacity:1; }
  100%   { transform: translateY(0%);    opacity:1; }
}

/* Rail */
.rail{grid-column:1; grid-row:2; padding:14px; border-right:1px solid var(--border)}
.rail h3{margin:6px 0 12px; font-size:14px}
.rail-section{margin-top:16px}
.rail-nav{display:grid; gap:8px}
.rail-btn{ text-align:left; border:1px solid var(--border); background:rgba(0,0,0,.15); color:var(--text); padding:8px 10px; border-radius:10px; cursor:pointer }
.rail-btn:hover{ border-color:var(--accent) }
.history{ margin:8px 0 0; padding-left:16px; color:var(--muted); font-size:12px }

/* Content + Chat */
.content {
  grid-column: 2; 
  grid-row: 2;
  display: grid;
  grid-template-rows: 1fr auto;   /* scroller grows, composer sits below */
  min-height: 0;                  /* critical so the scroller can shrink */
}
.chat {
  padding: 16px;
  overflow-y: auto;               /* the only scroll container */
  min-height: 0;
  padding-bottom: 0 !important;   /* no bottom padding needed now */
}
.messages {
  max-width: 1100px;          /* was 820px */
  margin: 0 auto;
  display: grid;
  gap: 12px;
}

/* Bottom fade lives on the chat, not the composer (fixes black box) */
.chat::after { content: none !important; }


/* Bubbles */
.msg{ display:flex }
.msg-user{ justify-content:flex-end }
.msg-ai{ justify-content:flex-start }
.bubble{
  max-width:min(900px,95%); padding:10px 14px; border-radius:14px;
  border:1px solid rgba(255,255,255,.18);
  white-space:pre-wrap; line-height:1.4;
  backdrop-filter:blur(10px) saturate(130%); -webkit-backdrop-filter:blur(10px) saturate(130%);
}
.msg-user .bubble{ background:rgba(230,249,236,.65); border-color:rgba(98,189,120,.35); color:#1b4022; box-shadow:0 2px 10px rgba(0,0,0,.08), inset 0 1px 0 rgba(255,255,255,.35) }
.msg-ai .bubble{ background:rgba(234,244,255,.65); border-color:rgba(120,160,220,.35); color:#152c47; box-shadow:0 2px 10px rgba(0,0,0,.08), inset 0 1px 0 rgba(255,255,255,.35) }

/* Typing dots */
.typing{ display:inline-flex; gap:4px; padding:6px 10px }
.dot{ width:6px; height:6px; border-radius:50%; background:var(--muted); opacity:.4; animation:blink 1.2s infinite ease-in-out }
.dot:nth-child(2){ animation-delay:.15s }
.dot:nth-child(3){ animation-delay:.3s }
@keyframes blink{ 0%,100%{opacity:.4} 50%{opacity:1} }

/* Composer (no overlay here anymore) */
.composer{
  position: static !important;    /* was absolute */
  left: auto; right: auto; bottom: auto;
  z-index: auto;
  background: transparent;
  padding: 12px 16px 16px;
  border-top: 1px solid rgba(255,255,255,0.12);
}
/* kill any earlier ::before overlay (prevents the black box) */
.composer::before{ content:none !important; }

.modes-row{ max-width:1200px; margin:0 auto 8px; display:flex; align-items:center; justify-content:space-between; gap:12px }
.modes{ display:flex; gap:8px; flex-wrap:wrap }
.mode-btn{ border:1px solid var(--border); background:rgba(0,0,0,.18); color:var(--muted); font-size:12px; padding:6px 12px; border-radius:999px; cursor:pointer }
.mode-btn:hover{ color:var(--text); border-color:var(--accent) }
.mode-btn.active{ color:var(--text); border-color:var(--accent); box-shadow:0 0 0 2px rgba(36,89,255,.12) inset }
.reset-btn{ border:1px solid var(--border); background:rgba(255,0,0,.1); color:var(--danger); font-size:12px; padding:6px 12px; border-radius:999px; cursor:pointer }
.reset-btn:hover{ border-color:var(--danger) }

/* Input row */
.input-wrap{
  position:relative; max-width:1200px; margin:0 auto;
  display:grid; grid-template-columns:1fr auto; gap:8px;
  background:rgba(0,0,0,.18); border:1px solid var(--border); border-radius:12px; padding:8px;
}
textarea{ width:100%; resize:none; background:transparent; color:var(--text); border:none; outline:none; font-size:15px }
button#send{ background:var(--accent); color:#fff; border:none; border-radius:10px; padding:10px 14px; cursor:pointer; font-weight:600 }
button#send[disabled]{ opacity:.6; cursor:not-allowed }

/* Responsive */
@media (max-width:1400px){ .glass{ inset:100px 140px } }
@media (max-width:1100px){ .glass{ inset:90px 90px } }
@media (max-width:880px){
  .glass{ inset:70px 20px; grid-template-columns:1fr; grid-template-rows:auto auto 1fr }
  .topbar{ grid-column:1 }
  .rail{ grid-column:1; grid-row:2; border-right:none; border-bottom:1px solid var(--border) }
  .content{ grid-column:1; grid-row:3 }
}
@media (max-width:520px){ .glass{ inset:48px 12px } }

/* Utility */
.sr-only{ position:absolute; left:-9999px; width:1px; height:1px; overflow:hidden }
.project-select{ width:100%; background:rgba(0,0,0,.18); color:var(--text); border:1px solid var(--border); border-radius:10px; padding:8px 10px; font-size:14px }
.small-muted{ color:var(--muted); font-size:12px }
